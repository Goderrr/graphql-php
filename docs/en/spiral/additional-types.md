# Подключение дополнительных GraphQL типов

Библиотека предоставляет возможность регистрации в реестре дополнительных GraphQL типов для их
последующего использования в вашем приложении. Это бывает полезно, если вам необходимо использовать
сторонние библиотеки.

Для автоматической регистрации вы можете [расширить перечень директорий](https://spiral.dev/docs/advanced-tokenizer/current#customizing-search-directories),
которые будет сканировать Tokenizer или перечислить GraphQL типы в конфигурации самостоятельно.

Пример конфигурации `config/graphql.php`:

```php
return [
    ...

    'additionalTypes' => [
        \GraphQL\Upload\UploadType::class => \Nyholm\Psr7\UploadedFile::class,
        \Andi\GraphQL\Type\DateTime::class => [\DateTimeImmutable::class, \DateTimeInterface::class],
        \Andi\GraphQL\Type\Date::class,
    ],
];
```

Опция конфигурации `'additionalTypes'` должна быть массивом и содержать значения с числовыми или
строковыми ключами. Если ключ является числом, то в качестве значения ожидается строка - имя класса,
определяющий GraphQL тип. Если ключ - строка, то ключ интерпретируется библиотекой как имя класса,
определяющий GraphQL тип, а значение(я) ключа - как псевдоним(ы) GraphQL типа, причем псевдонимов может
быть несколько.

Псевдонимы используются библиотекой для автоматического сопоставления GraphQL типа по соответствующему
определению метода/аргумента.

```php
namespace App\GraphQL\Field;

use Andi\GraphQL\Attribute\QueryField;

final class SimpleService
{
    ...

    #[QueryField]
    public function currentTime(): \DateTimeInterface
    {
        return new \DateTimeImmutable();
    }
}
```

В примере выше библиотека автоматически определит тип поля как `DateTimeInterface` и по
указанному в реестре псевдониму найдет соответствующий GraphQL тип поля - `DateTime`, определенного
в классе `Andi\GraphQL\Type\DateTime`.

## <a id="date-time">Скалярный тип `DateTime`</a>

Библиотека включает в себя скалярный GraphQL тип `DateTime`, определенный в классе
`Andi\GraphQL\Type\DateTime`. При использовании данного типа в GraphQL запросе (в качестве аргумента
или поля входящего объектного типа) допустимо использование строковых значений следующих форматов:
- `Y-m-d` - запись дня в формате ISO-8601, в этом случае часы, минуты и секунды будут выставлены в
  нулевое значение, а часовой пояс `UTC`;
- `Y-m-d\TH:i:s` - запись даты-времени в формате ISO-8601 без часового пояса, в этом случае часовой
  пояс будет выставлен `UTC`;
- `Y-m-d\TH:i:sP` - полная запись даты времени с указанным часовым поясом в формате ISO-8601.

При этом, для параметров php методов, значений свойств классов, переданное в GraphQL запросе строковое
значение будет преобразовано в `\DateTimeImmutable` объект.

> :point_right: **Важно!** :point_left:
>
> Не используйте класс `\DateTime` в качестве типа для параметров методов, свойств классов или
> типа возвращаемого значения метода. Вместо этого используйте `\DateTimeImmutable` или
> `\DateTimeInterface`.

По умолчанию данный скалярный GraphQL тип не зарегистрирован в реестре типов. Его необходимо
подключить одним из способов, указанных в начале данной статьи.

## <a id="date">Скалярный тип `Date`</a>

Библиотека включает в себя скалярный GraphQL тип `Date`, определенный в классе
`Andi\GraphQL\Type\Date`. При использовании данного типа в GraphQL запросе (в качестве аргумента
или поля входящего объектного типа) допустимо использование строковых значений формата `Y-m-d`.

При этом, для параметров php методов, значений свойств классов, переданное в GraphQL запросе строковое
значение будет преобразовано в `\DateTimeImmutable` объект. При этом часы, минуты и секунды будут иметь
нулевые значения, а часовой пояс `UTC`.

> :point_right: **Важно!** :point_left:
>
> Как и для скалярного GraphQL типа `DateTime` не используйте php класс `DateTime`.

По умолчанию данный скалярный GraphQL тип не зарегистрирован в реестре типов. Его необходимо
подключить одним из способов, указанных в начале данной статьи.
